<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2017-03-18">

<title>robertslab.info - Troubleshooting - Synology NAS (Owl) Down After Update</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../..//images/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">robertslab.info</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-hdd-network" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-hdd-network" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-hdd-network">    
        <li>
    <a class="dropdown-item" href="http://raven.fish.washington.edu:8787" rel="" target="_blank">
 <span class="dropdown-text">raven</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://gannet.fish.washington.edu" rel="" target="">
 <span class="dropdown-text">gannet</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-journal-code" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-journal-code" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-journal-code">    
        <li>
    <a class="dropdown-item" href="https://robertslab.github.io/sams-notebook/" rel="" target="">
 <span class="dropdown-text">sam</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://sr320.github.io" rel="" target="">
 <span class="dropdown-text">steven</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/RobertsLab" rel="" target="">
 <span class="dropdown-text">Lab Organization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/RobertsLab/lab-website" rel="" target="">
 <span class="dropdown-text">Edit Roberts Lab website</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://calendar.google.com/calendar/embed?src=mrc305@gmail.com&amp;ctz=America/Vancouver" rel="" target=""><i class="bi bi-calendar-week" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Troubleshooting - Synology NAS (Owl) Down After Update</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">2017</div>
                <div class="quarto-category">Computer Servicing</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 18, 2017</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>TL;DR - Server didn’t recover after firmware update last night. “Repair” is an option listed in the web interface, but I want to confirm with Synology what will happen if/when I click that button…</p>
<p>The data on Owl is synced here (Google Drive): <a href="https://drive.google.com/drive/folders/0BzKkDWZ6tIK4eXV4VFB3VHN2ZUk">UW Google Drive</a></p>
<p>However, not all of Owl was fully synced at the time of this failure, so it seems like a decent amount of data is not accessible. Inaccessible data is mostly from individual user directories.</p>
<p>All high-throughput sequencing is also backed up to Amazon Glacier, so we do have all of that data.</p>
<p>Here is what happened, in chronological order:</p>
<ol type="1">
<li><p>Updated DSM via web interface in “Update &amp; Restore”. Did NOT perform manual install.</p></li>
<li><p>System became inaccessible via web interface and Synology Assistant.</p></li>
<li><p>The physical unit showed blue, flashing power light and green flashing LAN1 light.</p></li>
<li><p>No other lights were illuminated (this includes no lights for any of the drive bays).</p></li>
<li><p>The attached expansion unit (DX513) showed steady blue power light, steady green lights on all drive bays, and steady green eSATA light.</p></li>
<li><p>I powered down both units via the DS1812+ power button.</p></li>
<li><p>I turned on the both units via the DS1812+ power button.</p></li>
<li><p>Both units returned to their previous status and were still inaccessible via the web interface and Synology Assistant.</p></li>
<li><p>I powered down both units via the DS1812+ power button.</p></li>
<li><p>I removed all drives from both units.</p></li>
<li><p>I turned on the both units via the DS1812+ power button.</p></li>
<li><p>I connected to the DS1812+ via Synology Assistant. A message indicated “No Hard Disk Found on 1812+”.</p></li>
<li><p>I powered down both units via the DS1812+ power button.</p></li>
<li><p>I added a single HDD to the DS1812+.</p></li>
<li><p>I turned on the both units via the DS1812+ power button.</p></li>
<li><p>I connected to the DS1812+ via Synology Assistant. I was prompted to install the latest DSM. I followed the steps and created a new admin account. Now the system shows 7 drives in the DS1812+ with a message: “System Partition Failed; Healthy”. Disk 1 shows a “Normal” status; this is the disk that I used to re-install DSM in Step 14. Additionally, the system shows one unused disk in the DX513.</p></li>
<li><p>I powered down both units via the web interface.</p></li>
<li><p>I removed Disk 1 from DS1812+.</p></li>
<li><p>I turned on the both units via the DS1812+ power button.</p></li>
<li><p>The DS1812+ returns to its initial state as described in Step 3.</p></li>
<li><p>I powered down both units via the DS1812+ power button.</p></li>
<li><p>I returned Disk 1 to its bay.</p></li>
<li><p>I turned on the both units via the DS1812+ power button.</p></li>
<li><p>There’s an option to “Repair” the Volume, but I’m not comfortable doing so until I discuss the in/outs of this with Synology. Submitted a tech support ticket with Synology.</p></li>
</ol>
<p>Below are pictures of the entire process, for reference.</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/IMG_20170318_082611.jpg" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/IMG_20170318_082611.jpg) Server status when I arrived to lab this morning.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“699”]<img src="https://eagle.fish.washington.edu/Arabidopsis/IMG_20170318_073022.jpg" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/IMG_20170318_073022.jpg) Pulled the HDDs from both units, in an attempt to be able to connect via Synology Assistant.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/IMG_20170318_073006.jpg" class="img-fluid"> Units w/o HDDs.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Synology_Assistant_and_synology_flashing_power_light_-_Google_Search.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Synology_Assistant_and_synology_flashing_power_light_-_Google_Search.png) No HDDs in units made the server detectable via Synology Assistant, but it indicates “Not installed” in the “Status” column…[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Synology_Web_Assistant_no_disk.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Synology_Web_Assistant_no_disk.png) Successfully connected, but the DS1812+ indicates no HDDs installed.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/IMG_20170318_073622.jpg" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/IMG_20170318_073622.jpg) Added a single HDD back to the DS1812+. Notice, the drive light is green and the “Status” light is amber. This is actually an improvement over what I saw when I arrived.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“522”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Synology_Web_Assistant_welcome.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Synology_Web_Assistant_welcome.png) Added back a single HDD to the DS1812+ and now have this setup menu.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“699”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Synology_Web_Assistant_install.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Synology_Web_Assistant_install.png) I’m prompted to install the Synology DSM.[/caption]</p>
<p>[caption id=“” align=“alignleft” width=“701”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Synology_Web_Assistant_dsm_install.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Synology_Web_Assistant_dsm_install.png) Installing DSM. This “Formatting system partition” message might be related to the eventual error message that I see (“System Partition Failed”) after this is all set up…[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“701”]<img src="https://eagle.fish.washington.edu/Arabidopsis/DiskStation%c2%a0-%c2%a0Synology%c2%a0DiskStation_new_admin.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/DiskStation%c2%a0-%c2%a0Synology%c2%a0DiskStation_new_admin.png) Prompted to create an admin account. This does not bode well, since this is behaving like a brand new installation (i.e.&nbsp;no record of the previous configuration, users, etc.).[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_setup.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_setup.png) Continuing set up.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“699”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_new_admin_set.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_new_admin_set.png) All set up…[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Synology_Assistant_and_installed_synology_DSM_working.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Synology_Assistant_and_installed_synology_DSM_working.png) Added all the HDDs back and detected via Synology Assistant.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_users_gone.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_users_gone.png) This shows that there are no other users - i.e.&nbsp;previous configuration is not detected.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_crash_disk.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_crash_disk.png) After putting all the HDDs back in, got this message after logging in.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_failed_partition.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_failed_partition.png) Looking at the Storage info in DSM; seems bad.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/IMG_20170318_085956.jpg" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/IMG_20170318_085956.jpg) Physically, the drives all look fine (green lights on all drive bays), despite the indication in the DSM about “System Partition Failed” for all of them (except Disk 1). The expansion unit’s bay lights are actually all green, but were actively being read at the time of picture (i.e.&nbsp;flashing) so the image didn’t capture all of them being green. Amber light on expansion unit reflects what was seen in the DSM - the middle drive is “Not initialized”. Note, the drive is actually inserted, but the handle has been released.[/caption]</p>
<p>[caption id=“” align=“alignnone” width=“700”]<img src="https://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_storage_manager.png" class="img-fluid">(http://eagle.fish.washington.edu/Arabidopsis/Owl%c2%a0-%c2%a0Synology%c2%a0DiskStation_storage_manager.png) This is how I left the system. Notice that after rebooting, the expansion unit no longer shows that “Not initialized” message for Disk 3. Instead, Disk 3 is now detected as installed, but not used…[/caption]</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>